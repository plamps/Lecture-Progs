# Συγγραφέας: Πέτρος Λάμψας
# Makefile για μεταγλώττιση έργων με περισσότερα από ένα αρχεία. 
# Αυτό το Makefile θεωρεί ότι οι φάκελοι του έργου είναι οργανωμένοι ως εξής:
# 1. Στον κεντρικό φάκελο βρίσκεται το Makefile και οι υποφάκελοι src και obj
# 2. Ο πηγαίος κώδικας βρίσκεται στον υποφάκελο ./src
# 3. Τα αρχεία .o θα τοποθετηθούν στον υποφάκελο ./obj 
# 4. Το εκτελέσιμο θα τοποθετηθεί στον κεντρικό φάκελο του έργου
# Οι κατάλογοι αυτοί πρέπει να έχουν δημιουργηθεί από το χρήστη.

# Μεταβλητές που περιέχουν απαραίτητες για τη μεταγλώττιση τιμές
# Η CFLAGS έχει τιμή τις παραμέτρους της μεταγλώττισης
# Η CC έχει τιμή τον μεταγλωττιστή που θα χρησιμοποιηθεί
# Η SRC έχει τιμή το φάκελο που βρίσκεται ο πηγαίος κώδικας
# Η ODIR έχει τιμή το φάκελο που θα τοποθετηθούν τα object files
IDIR = ./src/incl
CC = gcc
CFLAGS = -I$(IDIR) -std=c17 -Wall -Wextra -Wpedantic -fanalyzer -g -O2
SRC = ./src
ODIR = ./obj

# Αν χρειάζεται, εδώ δίνουμε φάκελο που περιέχει βιβλιοθήκες 
# που χρειάζονται στη μεταγλώττιση
#LDIR =./lib

# Οι βιβλιοθήκες 
LIBS = #-lm ή όποια άλλη βιβλιοθήκη χρειάζεται να συνδεθεί με σαφήνεια

# Δήλωση εξάρτησης από αρχείο επικεφαλίδας
DEPS = $(IDIR)/myheader.h
# Το όνομα του εκτελέσιμου 
EXEC = myprog
# Η μεταβλητή OBJS περιέχει τα αρχεία .o που 
# απαιτείται να διασυνδεθούν για να δημιουργηθεί το
# εκτελέσιμο
OBJS = $(ODIR)/myprog.o $(ODIR)/functions.o
# Η μεταβλητή ARGS περιέχει τις παραμέτρους που θα
# δοθούν ως είσοδος στο πρόγραμμα
ARGS = 

# Κανόνας για τη μεταγλώττιση των αρχείων που θα διασυνδεθούν
$(ODIR)/%.o: $(SRC)/%.c $(DEPS)
	$(CC) -c -o $@ $< $(CFLAGS)

# Δήλωση εξαρτήσεων και δημιουργία εκτελέσιμου 
$(EXEC): $(OBJS)
	$(CC) $(CFLAGS) $(OBJS) -o $(EXEC) $(LIBS)

# Ετικέτα για την εκτέλεση του προγράμματος
run: $(EXEC)
	./$(EXEC) $(ARGS)

.PHONY: clean

# Καθαρισμός .ο αρχείων: Windows
clean:
	powershell -Command "Remove-Item '$(ODIR)/*'"
#	powershell -Command "Remove-Item '<path>/*' -Recurse -Force"

# Καθαρισμός .ο αρχείων: Linux
#clean:
#	rm -f $(ODIR)/*.o *~ core $(INCDIR)/*~ 